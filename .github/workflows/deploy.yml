name: FTP Deploy to InfinityFree

on:
  push:
    branches: [ main ]

jobs:
  ftp-deploy:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - name: Create `api/config.local.php` and optional `.htaccess` from DB secrets
        shell: bash
        run: |
          if [ -n "${{ secrets.DB_PASS }}" ]; then
            mkdir -p api

            # Create a PHP config file readable by the app on the server.
            printf '%s\n' "<?php" "return [" \
              "  'host' => '${{ secrets.DB_HOST }}'," \
              "  'port' => (int)${{ secrets.DB_PORT }} ," \
              "  'dbname' => '${{ secrets.DB_NAME }}'," \
              "  'user' => '${{ secrets.DB_USER }}'," \
              "  'pass' => '${{ secrets.DB_PASS }}'," \
              "  'ssl_ca' => null," \
              "];" > api/config.local.php
            echo "api/config.local.php created"

            # Optionally create .htaccess so servers that respect SetEnv can also see vars
            printf '%s\n' '# Generated by GitHub Actions from repository secrets' \
              "SetEnv DB_HOST ${{ secrets.DB_HOST }}" \
              "SetEnv DB_PORT ${{ secrets.DB_PORT }}" \
              "SetEnv DB_NAME ${{ secrets.DB_NAME }}" \
              "SetEnv DB_USER ${{ secrets.DB_USER }}" \
              "SetEnv DB_PASS ${{ secrets.DB_PASS }}" > .htaccess
            echo ".htaccess created"
          else
            echo "DB_PASS not set â€” skipping config and .htaccess creation"
          fi
name: disabled

on: []

# Disabled by user: CI/CD removed per project owner's request.
